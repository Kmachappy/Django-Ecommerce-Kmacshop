{% extends 'base.html' %}
{% load tailwind_tags %}
{% block title %} {{product.slug}} - {% endblock %}
    {% block content %}
    {% comment %} grow container with appropriate padding and width {% endcomment %}
    <div class=" my-10 mx-auto w-full md:container  grow ">
      <div id="alert-1" class="hidden flex p-4 mb-4 bg-blue-100 rounded-lg dark:bg-blue-200" role="alert">
        <svg aria-hidden="true" class="flex-shrink-0 w-5 h-5 text-blue-700 dark:text-blue-800" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
        <span class="sr-only">Info</span>
        <div class="ml-3 text-sm font-medium text-blue-700 dark:text-blue-800">
          Added product <span id="add-pro-name" class="underline">{{product.name}}</span> Quantity of <span id="add-pro-qty" class="underline"></span>
        </div>
          <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-blue-100 text-blue-500 rounded-lg focus:ring-2 focus:ring-blue-400 p-1.5 hover:bg-blue-200 inline-flex h-8 w-8 dark:bg-blue-200 dark:text-blue-600 dark:hover:bg-blue-300" data-dismiss-target="#alert-1" aria-label="Close">
            <span class="sr-only">Close</span>
            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
      </div>
     <section class="">
        <div class="container mx-auto px-4">
          <div class="flex flex-wrap -mx-4 mb-12">
            <div class="w-full md:w-1/2 px-4 mb-8 md:mb-0">
              <div class="relative mb-6" style="height: 564px;">
                <a class="absolute top-1/2 left-0 ml-8 transform translate-1/2" href="#">
                  <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 16.0185C9.268 16.2905 9.268 16.7275 9 16.9975C8.732 17.2675 8.299 17.2685 8.031 16.9975L0.201 9.0895C-0.067 8.8195 -0.067 8.3825 0.201 8.1105L8.031 0.2025C8.299 -0.0675 8.732 -0.0675 9 0.2025C9.268 0.4735 9.268 0.9115 9 1.1815L1.859 8.6005L9 16.0185Z" fill="#1F40FF"></path>
                  </svg>
                </a>
                <img class="shadow-2xl object-cover w-full h-full" src="{{ product.productimage_set.all.0 }}" alt="">
                <a class="absolute top-1/2 right-0 mr-8 transform translate-1/2" href="#">
                  <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.19922 1.1817C-0.0687795 0.909696 -0.0687794 0.472695 0.19922 0.202695C0.46722 -0.0673054 0.90022 -0.0683048 1.16822 0.202695L8.99822 8.11069C9.26622 8.3807 9.26622 8.81769 8.99822 9.08969L1.16822 16.9977C0.900219 17.2677 0.467218 17.2677 0.199219 16.9977C-0.0687809 16.7267 -0.0687808 16.2887 0.199219 16.0187L7.34022 8.5997L0.19922 1.1817Z" fill="#1F40FF"></path>
                  </svg>
                </a>
              </div>
              <div class="flex flex-wrap  -mx-2">
                {% for photo in product.productimage_set.all %}
                <div class="w-1/2 sm:w-1/4 p-2">
                  <a class="block border shadow-lg" href="#">
                    <img class="w-full h-32 object-cover" src="{{ photo }}" alt="{{ photo }}">
                  </a>
                </div>
                {% endfor %}
              </div>
            </div>
            <div class="w-full md:w-1/2 px-4">
              <div class="lg:pl-20">
                <div class="mb-10 pb-10 border-b">
                  <a href="{{product.category.get_absolute_url}}">
                    <span class="text-gray-500">Back to: <span class="underline hover:text-gray-800 ">{{product.category | title}}</span></span>
                  </a>
                  <h2 class="mt-2 mb-6 max-w-xl text-2xl md:text-3xl font-bold text-gray-600 font-heading">{{product.name}}</h2>
                  <div class="mb-8">
                    <button>
                      <img src="https://shuffle.dev/yofte-assets/elements/star-gold.svg" alt="*">
                    </button>
                    <button>
                      <img src="https://shuffle.dev/yofte-assets/elements/star-gold.svg" alt="*">
                    </button>
                    <button>
                      <img src="https://shuffle.dev/yofte-assets/elements/star-gold.svg" alt="*">
                    </button>
                    <button>
                      <img src="https://shuffle.dev/yofte-assets/elements/star-gold.svg" alt="*">
                    </button>
                    <button>
                      <img src="https://shuffle.dev/yofte-assets/elements/star-gray.svg" alt="*">
                    </button>
                  </div>
                  <p class="inline-block mb-8 text-2xl font-bold font-heading text-slate-600">
                    <span>${{product.price}}</span>
                    {% comment %} <span class="font-normal text-base text-gray-400 line-through">$33.69</span> {% endcomment %}
                  </p>
                  
                  
                  <p class="max-w-md text-gray-500">{{product.description}}</p>
                </div>
                <div class="flex mb-12">
                  <div class="mr-6">
                    <span class="block mb-4 font-bold font-heading text-gray-400 uppercase">QTY</span>
                    <div id="qty-adjuster" class="inline-flex items-center px-4 font-semibold font-heading text-gray-500 border border-gray-200 focus:ring-blue-300 focus:border-blue-300 rounded-md">
                      <button id="qty-adjuster-down" class="py-2 mr-4 hover:text-gray-700">
                        <svg width="12" height="2" viewBox="0 0 12 2" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.35"><rect x="12" width="2" height="12" transform="rotate(90 12 0)" fill="currentColor"></rect></g></svg>
                      </button>
                      <input id="qty-adjuster-value" class="w-16 m-0 px-2 py-4 text-center border-0 focus:ring-transparent focus:outline-none rounded-md" type="number" min="1" value="1">
                      <button id="qty-adjuster-up" class="py-2 ml-4 hover:text-gray-700">
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.35"><rect x="5" width="2" height="12" fill="currentColor"></rect><rect x="12" y="5" width="2" height="12" transform="rotate(90 12 5)" fill="currentColor"></rect></g></svg>
                      </button>
                    </div>
                  </div>
                  <div>
                    {% comment %} <span class="block mb-4 font-bold font-heading text-gray-400 uppercase">Size</span>
                    <select class="pl-6 pr-10 py-4 font-semibold font-heading text-gray-500 border border-gray-200 focus:ring-blue-300 focus:border-blue-300 rounded-md" name="" id="">
                      <option value="1">Medium</option>
                      <option value="2">Small</option>
                      <option value="3">Large</option>
                    </select> {% endcomment %}
                  </div>
                </div>
                
                <div class="flex flex-wrap -mx-4 mb-14 items-center">
                  {% comment %} ~~~~~~~~~~ add cart ~~~~ button {% endcomment %}
                  <div class="w-full xl:w-2/3 px-4 mb-4 xl:mb-0">
                    <button type="button" id="cart-button" value="{{product.id}}" class="w-full block bg-gray-500 hover:bg-gray-600 text-center text-white font-bold font-heading py-5 px-8 rounded-md uppercase transition duration-200" >Add to cart</button>
                  </div>
                  
                  <div class="w-full xl:w-1/3 px-4">
                    <a class="ml-auto sm:ml-0 flex-shrink-0 inline-flex mr-4 items-center justify-center w-16 h-16 rounded-md border hover:border-gray-500" href="#">
                      <svg class="w-6 h-6" width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.4993 26.2061L4.70067 16.9253C3.9281 16.1443 3.41815 15.1374 3.24307 14.0471C3.06798 12.9568 3.23664 11.8385 3.72514 10.8505V10.8505C4.09415 10.1046 4.63318 9.45803 5.29779 8.96406C5.96241 8.47008 6.73359 8.14284 7.54782 8.00931C8.36204 7.87578 9.19599 7.93978 9.98095 8.19603C10.7659 8.45228 11.4794 8.89345 12.0627 9.48319L13.4993 10.9358L14.9359 9.48319C15.5192 8.89345 16.2327 8.45228 17.0177 8.19603C17.8026 7.93978 18.6366 7.87578 19.4508 8.00931C20.265 8.14284 21.0362 8.47008 21.7008 8.96406C22.3654 9.45803 22.9045 10.1046 23.2735 10.8505V10.8505C23.762 11.8385 23.9306 12.9568 23.7556 14.0471C23.5805 15.1374 23.0705 16.1443 22.298 16.9253L13.4993 26.2061Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                      </svg>
                    </a>
                    <a class="flex-shrink-0 inline-flex items-center justify-center w-16 h-16 rounded-md border hover:border-gray-500" href="#">
                      <svg class="w-6 h-6" width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.01328 18.9877C2.05682 16.7902 2.71436 12.9275 6.3326 9.87096L6.33277 9.87116L6.33979 9.86454L6.3398 9.86452C6.34682 9.85809 8.64847 7.74859 13.4997 7.74859C13.6702 7.74859 13.8443 7.75111 14.0206 7.757L14.0213 7.75702L14.453 7.76978L14.6331 7.77511V7.59486V3.49068L21.5728 10.5736L14.6331 17.6562V13.6558V13.5186L14.4998 13.4859L14.1812 13.4077C14.1807 13.4075 14.1801 13.4074 14.1792 13.4072M2.01328 18.9877L14.1792 13.4072M2.01328 18.9877C7.16281 11.8391 14.012 13.3662 14.1792 13.4072M2.01328 18.9877L14.1792 13.4072M23.125 10.6961L23.245 10.5736L23.125 10.4512L13.7449 0.877527L13.4449 0.571334V1V6.5473C8.22585 6.54663 5.70981 8.81683 5.54923 8.96832C-0.317573 13.927 0.931279 20.8573 0.946581 20.938L0.946636 20.9383L1.15618 22.0329L1.24364 22.4898L1.47901 22.0885L2.041 21.1305L2.04103 21.1305C4.18034 17.4815 6.71668 15.7763 8.8873 15.0074C10.9246 14.2858 12.6517 14.385 13.4449 14.4935V20.1473V20.576L13.7449 20.2698L23.125 10.6961Z" fill="black" stroke="black" stroke-width="0.35"></path>
                      </svg>
                    </a>
                  </div>
                </div>
                <div class="flex items-center">
                  <span class="mr-8 text-gray-500 font-bold font-heading uppercase">SHARE IT</span>
                  <a class="mr-1 w-8 h-8" href="#">
                    <img src="https://shuffle.dev/yofte-assets/buttons/facebook-circle.svg" alt="">
                  </a>
                  <a class="mr-1 w-8 h-8" href="#">
                    <img src="https://shuffle.dev/yofte-assets/buttons/instagram-circle.svg" alt="">
                  </a>
                  <a class="w-8 h-8" href="#">
                    <img src="https://shuffle.dev/yofte-assets/buttons/twitter-circle.svg" alt="">
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          <div>
            <a href="{{product.category.get_absolute_url}}">
              <p class="text-2xl font-semibold text-gray-600">More {{product.category}}</p>
            </a>
          </div>
          {% comment %} Grid start {% endcomment %}
          <div class="my-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-5">
            {% for p in product.category.get_products %}
            
            {% comment %} ~~~~CARD START~~~~ {% endcomment %}
            <div class=" p-2 md:p-4 lg:p-5 bg-white ">
              {% comment %} container for the whole inner {% endcomment %}
              <div class="product-container-inner flex flex-col grow relative">
                {% comment %} container for the image margin bottom and min height{% endcomment %}
                  <div class="image-container mb-4 w-full relative">
                    {% comment %} href for the product being the image {% endcomment %}
                    <a class="block" href="{{p.get_absolute_url}}">
                      <img class="pt-0 w-full h-full" src="{{p.productimage_set.all.0 }}" alt="{{p.image}}"> 
                    </a>
                  </div>
                  
                {% comment %} container for the product name and price {% endcomment %}
                <div class="flex flex-col justify-between">
                  <a href="{{p.get_absolute_url}}" class="block text-slate-600 font-normal font-sans    text-base xs:text-lg pt-0.5 mb-1">{{p.name}}</a>
                  </a>
                  <div class="mt-2">
                    <span class="font-semibold font-sans text-xl text-gray-600">${{p.price}}</span>
                  </div>
                </div>
                  
                </div>
                {% endfor %}
              </div>
              {% comment %} ~~~~CARD END~~~~ {% endcomment %}

            </div>
            {% comment %} Grid end {% endcomment %}
         
            
            <div class="container">
              <div class="w-full rounded-lg shadow-md shadow-slate-600/50">
                <form action="{% url 'main_app:add_review' product.id %}" method="post" class="w-full p-4">
                  <label for="review-form">Add a Review</label>
                  <div id="review-form" class="mb-2">
                    {% csrf_token %}
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="title">
                      {{form.title.label}}
                      {{form.title }}
                    <label for="comment" class="text-lg text-gray-600">{{form.content.label}}</label>
                    {{form.content }}
                  </div>
                  <div>
                    {% if user.is_authenticated %}
                    
                    <button type="submit" class="bg-slate-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg">
                      Submit
                    </button>
                    
                    <button
                      class="bg-slate-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg">
                      Cancel
                    </button>
                    {% else %}
                   

                      <a href="{% url 'main_app_account:login'%}"  class=" px-3 py-2 text-sm text-blue-100 bg-red-600 rounded">
                        Log In To Review
                      </a>
                    
                    {% endif %}

                  </div>
                </form>
              </div>
            </div>
          
          {% comment %} Reviews start {% endcomment %}
         

          {% comment %} <div>
            <ul class="flex flex-wrap mb-16 border-b-2">
              <li class="w-1/2 md:w-auto"><a class="inline-block py-6 px-10 bg-white text-gray-500 font-bold font-heading shadow-2xl" href="#">Description</a></li>
              <li class="w-1/2 md:w-auto"><a class="inline-block py-6 px-10 text-gray-500 font-bold font-heading" href="#">Customer reviews</a></li>
              <li class="w-1/2 md:w-auto"><a class="inline-block py-6 px-10 text-gray-500 font-bold font-heading" href="#">Shipping &amp; returns</a></li>
              <li class="w-1/2 md:w-auto"><a class="inline-block py-6 px-10 text-gray-500 font-bold font-heading" href="#">Brand</a></li>
            </ul>
            <h3 class="mb-8 text-3xl font-bold font-heading text-blue-300">Summer collection and laoreet get</h3>
            <p class="max-w-2xl text-gray-500">I had interdum at ante porta, eleifend feugiat nunc. In semper euismod mi a accums lorem sad. Morbi at auctor nibh. Aliquam tincidunt placerat mollis. Lorem euismod dignissim, felis tortor ollis eros, non ultricies turpis.</p>
          </div> {% endcomment %}
        </div>
      </section>

       
      {% for review in product.productreview_set.all %}
          title:{{review.title}} <br>

          content: {{review.content}} <br>
          user: {{review.user}} <br>
          Created at: {{review.created_at}} <br>
      {% endfor %}
    </div>


    <script>
      $(document).on('click', '#cart-button', function(e){
        let $productqty = String($("#qty-adjuster-value").val());
        e.preventDefault();
        $.ajax({
          type: 'POST',
          url: '{% url "main_app_cart:cart_add" %}',
          data:{
            productid: $('#cart-button').val(),
            productqty: $("#qty-adjuster-value").val(),
            csrfmiddlewaretoken: "{{ csrf_token }}",
            action: 'post',
          },
          success: function(json){
              $("#cart-qty").text(json.quantity)
              $("#alert-1").removeClass("hidden")
              $("#add-pro-qty").text($productqty)
          },
          error: function(xhr, errmsg, err){
            console.log(err)
            console.log(errmsg)
            console.log(xhr.status + ": " + xhr.responseText);
          }
        })
      })
    
    </script>


    {% endblock %}